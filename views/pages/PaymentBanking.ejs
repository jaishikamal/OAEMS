<!-- Content -->
<div class="container-xxl flex-grow-1 container-p-y">
  <!-- Success/Error Messages -->
  <% if (typeof success !== 'undefined' && success) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= success %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  <% } %> <% if (typeof error !== 'undefined' && error) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  <% } %>

  <!-- Header section-->
  <div class="row gy-3 align-items-center mb-4">
    <div class="col-lg-6">
      <div class="d-flex align-items-start gap-2">
        <div class="avatar avatar-md flex-shrink-0 bg-label-primary">
          <span class="avatar-initial rounded">
            <i class="icon-base ti tabler-credit-card"></i>
          </span>
        </div>
        <div>
          <h4 class="mb-1">Payment & Banking Details Management</h4>
          <p class="text-muted mb-0">
            Manage payment modes and banking information here.
          </p>
        </div>
      </div>
    </div>
    <div class="col-lg-6 d-flex flex-wrap justify-content-lg-end gap-2">
      <button
        type="button"
        class="btn btn-label-primary"
        data-bs-toggle="modal"
        data-bs-target="#addModal"
      >
        <i class="icon-base ti tabler-plus me-1"></i>Add Payment Details
      </button>
    </div>
  </div>
  <!--Header section---->

  <div class="col-12">
    <!-- Payment Banking Table -->
    <div class="card">
      <div class="card-datatable">
        <table class="datatables-users table border-top">
          <thead>
            <tr>
              <th>ID</th>
              <th>Payment Mode</th>
              <th>Bank Name</th>
              <th>Account Name</th>
              <th>Account Number</th>
              <th>Payment Terms</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (paymentBankingDetails && paymentBankingDetails.length > 0) { %>
            <% paymentBankingDetails.forEach(function(payment) { %>
            <tr>
              <td><%= payment.id %></td>
              <td>
                <span class="badge bg-label-info">
                  <%= payment.preferredPaymentMode %>
                </span>
              </td>
              <td><%= payment.bankName || 'N/A' %></td>
              <td><%= payment.accountName || 'N/A' %></td>
              <td><%= payment.accountNumber || 'N/A' %></td>
              <td>
                <span class="badge bg-label-success">
                  <%= payment.paymentTerms %>
                </span>
              </td>
              <td class="text-end">
                <div class="d-inline-flex gap-2">
                  <button
                    class="btn btn-sm btn-icon btn-text-secondary rounded-pill btn-edit"
                    data-id="<%= payment.id %>"
                    data-preferred-payment-mode="<%= payment.preferredPaymentMode %>"
                    data-bank-name="<%= payment.bankName || '' %>"
                    data-account-name="<%= payment.accountName || '' %>"
                    data-account-number="<%= payment.accountNumber || '' %>"
                    data-branch-name="<%= payment.branchName || '' %>"
                    data-payment-terms="<%= payment.paymentTerms %>"
                    title="Edit Payment Details"
                  >
                    <i class="icon-base ti tabler-edit"></i>
                  </button>
                  <form
                    action="/PaymentBanking/<%= payment.id %>/delete"
                    method="POST"
                    class="d-inline delete-form"
                  >
                    <button
                      class="btn btn-sm btn-icon btn-text-danger rounded-pill"
                      type="submit"
                      title="Delete Payment Details"
                    >
                      <i class="icon-base ti tabler-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            <% }); %> <% } else { %>
            <tr>
              <td colspan="7" class="text-center py-4">
                <div class="text-muted">
                  <i class="icon-base ti tabler-alert-circle fs-3 mb-2"></i>
                  <p>No payment details found. Please add new payment details.</p>
                </div>
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <!--/ Payment Banking Table -->
  </div>

  <!-- Add Modal -->
  <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
          <div class="text-center mb-6">
            <h4 class="mb-2">Add New Payment & Banking Details</h4>
            <p class="text-body-secondary">Enter payment and banking information</p>
          </div>
          <!-- Add payment banking form -->
          <form action="/PaymentBanking" method="POST" id="addForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label" for="preferredPaymentMode">
                  Preferred Payment Mode <span class="text-danger">*</span>
                </label>
                <select
                  id="preferredPaymentMode"
                  name="preferredPaymentMode"
                  class="form-select"
                  required
                >
                  <option value="">Select Payment Mode</option>
                  <option value="Bank Transfer">Bank Transfer</option>
                  <option value="Cash">Cash</option>
                  <option value="Cheque">Cheque</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label" for="paymentTerms">
                  Payment Terms <span class="text-danger">*</span>
                </label>
                <select
                  id="paymentTerms"
                  name="paymentTerms"
                  class="form-select"
                  required
                >
                  <option value="">Select Payment Terms</option>
                  <option value="Net 15">Net 15</option>
                  <option value="Net 30">Net 30</option>
                  <option value="Net 45">Net 45</option>
                  <option value="Net 60">Net 60</option>
                  <option value="Due on Receipt">Due on Receipt</option>
                  <option value="COD">COD</option>
                </select>
              </div>
            </div>

            <div id="bankingFieldsContainer" >
              <hr class="my-4">
              <h5 class="mb-3">Banking Information</h5>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="bankName">
                    Bank Name <span class="text-danger" id="bankNameRequired">*</span>
                  </label>
                  <input
                    type="text"
                    id="bankName"
                    name="bankName"
                    class="form-control"
                    placeholder="Enter bank name"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="accountName">
                    Account Name <span class="text-danger" id="accountNameRequired">*</span>
                  </label>
                  <input
                    type="text"
                    id="accountName"
                    name="accountName"
                    class="form-control"
                    placeholder="Enter account name"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="accountNumber">
                    Account Number <span class="text-danger" id="accountNumberRequired">*</span>
                  </label>
                  <input
                    type="text"
                    id="accountNumber"
                    name="accountNumber"
                    class="form-control"
                    placeholder="Enter account number"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="branchName">
                    Branch Name
                  </label>
                  <input
                    type="text"
                    id="branchName"
                    name="branchName"
                    class="form-control"
                    placeholder="Enter branch name (optional)"
                  />
                </div>
              </div>
            </div>

            <div class="col-12 text-center mt-4">
              <button type="submit" class="btn btn-primary me-3">
                Add Payment Details
              </button>
              <button
                type="reset"
                class="btn btn-label-secondary"
                data-bs-dismiss="modal"
                aria-label="Close"
              >
                Cancel
              </button>
            </div>
          </form>
          <!--/ Add payment banking form  -->
        </div>
      </div>
    </div>
  </div>
  <!--/ Add Modal -->

  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
          <div class="text-center mb-6">
            <h4 class="mb-2">Edit Payment & Banking Details</h4>
            <p class="text-body-secondary">Update payment and banking information</p>
          </div>
          <!-- Edit payment banking form -->
          <form id="editForm" method="POST">
            <input type="hidden" id="edit_id" name="id" />
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label" for="edit_preferredPaymentMode">
                  Preferred Payment Mode <span class="text-danger">*</span>
                </label>
                <select
                  id="edit_preferredPaymentMode"
                  name="preferredPaymentMode"
                  class="form-select"
                  required
                >
                  <option value="">Select Payment Mode</option>
                  <option value="Bank Transfer">Bank Transfer</option>
                  <option value="Cash">Cash</option>
                  <option value="Cheque">Cheque</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label" for="edit_paymentTerms">
                  Payment Terms <span class="text-danger">*</span>
                </label>
                <select
                  id="edit_paymentTerms"
                  name="paymentTerms"
                  class="form-select"
                  required
                >
                  <option value="">Select Payment Terms</option>
                  <option value="Net 15">Net 15</option>
                  <option value="Net 30">Net 30</option>
                  <option value="Net 45">Net 45</option>
                  <option value="Net 60">Net 60</option>
                  <option value="Due on Receipt">Due on Receipt</option>
                  <option value="COD">COD</option>
                </select>
              </div>
            </div>

            <div id="edit_bankingFieldsContainer" >
              <hr class="my-4">
              <h5 class="mb-3">Banking Information</h5>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="edit_bankName">
                    Bank Name <span class="text-danger" id="edit_bankNameRequired">*</span>
                  </label>
                  <input
                    type="text"
                    id="edit_bankName"
                    name="bankName"
                    class="form-control"
                    placeholder="Enter bank name"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="edit_accountName">
                    Account Name <span class="text-danger" id="edit_accountNameRequired">*</span>
                  </label>
                  <input
                    type="text"
                    id="edit_accountName"
                    name="accountName"
                    class="form-control"
                    placeholder="Enter account name"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="edit_accountNumber">
                    Account Number <span class="text-danger" id="edit_accountNumberRequired">*</span>
                  </label>
                  <input
                    type="text"
                    id="edit_accountNumber"
                    name="accountNumber"
                    class="form-control"
                    placeholder="Enter account number"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="edit_branchName">
                    Branch Name
                  </label>
                  <input
                    type="text"
                    id="edit_branchName"
                    name="branchName"
                    class="form-control"
                    placeholder="Enter branch name (optional)"
                  />
                </div>
              </div>
            </div>

            <div class="col-12 text-center mt-4">
              <button type="submit" class="btn btn-warning me-3">
                Update Payment Details
              </button>
              <button
                type="reset"
                class="btn btn-label-secondary"
                data-bs-dismiss="modal"
                aria-label="Close"
              >
                Cancel
              </button>
            </div>
          </form>
          <!--/ Edit payment banking form -->
        </div>
      </div>
    </div>
  </div>
  <!--/ Edit Modal -->
</div>
<!-- / Content -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Add Form - Handle payment mode change
    const paymentModeSelect = document.getElementById("preferredPaymentMode");
    const bankingFieldsContainer = document.getElementById("bankingFieldsContainer");
    const bankNameInput = document.getElementById("bankName");
    const accountNameInput = document.getElementById("accountName");
    const accountNumberInput = document.getElementById("accountNumber");

    paymentModeSelect.addEventListener("change", function () {
      if (this.value === "Bank Transfer") {
        bankingFieldsContainer.style.display = "block";
        bankNameInput.required = true;
        accountNameInput.required = true;
        accountNumberInput.required = true;
      } else {
        bankingFieldsContainer.style.display = "none";
        bankNameInput.required = false;
        accountNameInput.required = false;
        accountNumberInput.required = false;
        // Clear values
        bankNameInput.value = "";
        accountNameInput.value = "";
        accountNumberInput.value = "";
        document.getElementById("branchName").value = "";
      }
    });

    // Edit Form - Handle payment mode change
    const editPaymentModeSelect = document.getElementById("edit_preferredPaymentMode");
    const editBankingFieldsContainer = document.getElementById("edit_bankingFieldsContainer");
    const editBankNameInput = document.getElementById("edit_bankName");
    const editAccountNameInput = document.getElementById("edit_accountName");
    const editAccountNumberInput = document.getElementById("edit_accountNumber");

    editPaymentModeSelect.addEventListener("change", function () {
      if (this.value === "Bank Transfer") {
        editBankingFieldsContainer.style.display = "block";
        editBankNameInput.required = true;
        editAccountNameInput.required = true;
        editAccountNumberInput.required = true;
      } else {
        editBankingFieldsContainer.style.display = "none";
        editBankNameInput.required = false;
        editAccountNameInput.required = false;
        editAccountNumberInput.required = false;
      }
    });

    // Handle edit button clicks
    const editButtons = document.querySelectorAll(".btn-edit");
    const editModal = new bootstrap.Modal(document.getElementById("editModal"));
    const editForm = document.getElementById("editForm");

    editButtons.forEach((button) => {
      button.addEventListener("click", function () {
        const id = this.getAttribute("data-id");
        const preferredPaymentMode = this.getAttribute("data-preferred-payment-mode");
        const bankName = this.getAttribute("data-bank-name");
        const accountName = this.getAttribute("data-account-name");
        const accountNumber = this.getAttribute("data-account-number");
        const branchName = this.getAttribute("data-branch-name");
        const paymentTerms = this.getAttribute("data-payment-terms");

        // Set form action
        editForm.action = "/PaymentBanking/" + id;

        // Populate form fields
        document.getElementById("edit_id").value = id;
        document.getElementById("edit_preferredPaymentMode").value = preferredPaymentMode;
        document.getElementById("edit_bankName").value = bankName;
        document.getElementById("edit_accountName").value = accountName;
        document.getElementById("edit_accountNumber").value = accountNumber;
        document.getElementById("edit_branchName").value = branchName;
        document.getElementById("edit_paymentTerms").value = paymentTerms;

        // Show/hide banking fields based on payment mode
        if (preferredPaymentMode === "Bank Transfer") {
          editBankingFieldsContainer.style.display = "block";
          editBankNameInput.required = true;
          editAccountNameInput.required = true;
          editAccountNumberInput.required = true;
        } else {
          editBankingFieldsContainer.style.display = "none";
          editBankNameInput.required = false;
          editAccountNameInput.required = false;
          editAccountNumberInput.required = false;
        }

        // Show modal
        editModal.show();
      });
    });

    // Confirm delete
    const deleteForms = document.querySelectorAll(".delete-form");
    deleteForms.forEach((form) => {
      form.addEventListener("submit", function (e) {
        if (!confirm("Are you sure you want to delete this payment detail?")) {
          e.preventDefault();
        }
      });
    });

    // Reset form on modal close
    document.getElementById("addModal").addEventListener("hidden.bs.modal", function () {
      document.getElementById("addForm").reset();
      bankingFieldsContainer.style.display = "none";
      bankNameInput.required = false;
      accountNameInput.required = false;
      accountNumberInput.required = false;
    });
  });
</script>