<script src="assets/vendor/libs/jquery/jquery.js"></script>

<script src="assets/vendor/libs/popper/popper.js"></script>
<script src="assets/vendor/js/bootstrap.js"></script>
<script src="assets/vendor/libs/node-waves/node-waves.js"></script>

<script src="assets/vendor/libs/pickr/pickr.js"></script>

<script src="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

<script src="assets/vendor/libs/hammer/hammer.js"></script>

<script src="assets/vendor/libs/i18n/i18n.js"></script>

<script src="assets/vendor/js/menu.js"></script>

<!-- endbuild -->

<!-- Vendors JS -->
<script src="assets/vendor/libs/apex-charts/apexcharts.js"></script>
<script src="assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
<script src="assets/vendor/libs/sweetalert2/sweetalert2.js"></script>

<!-- Main JS -->

<script src="assets/js/main.js"></script>

<!-- Page JS -->
<script src="assets/js/app-logistics-dashboard.js"></script>

<!-- for branches page -->
<script src="assets/js/tables-datatables-basic.js"></script>

<!--for Approvals-->
<script>
  // Filter tab functionality
  document.addEventListener('DOMContentLoaded', function () {
    const filterButtons = document.querySelectorAll('[data-filter]');

    filterButtons.forEach(button => {
      button.addEventListener('click', function () {
        // Remove active class from all buttons
        filterButtons.forEach(btn => {
          btn.classList.remove('active', 'btn-primary');
          btn.classList.add('btn-label-primary');
        });

        // Add active class to clicked button
        this.classList.add('active', 'btn-primary');
        this.classList.remove('btn-label-primary');

        // Here you would filter the approval cards based on the selected filter
        const filter = this.getAttribute('data-filter');
        // Filter logic would go here
      });
    });
  });
</script>

<!--for Expenses-->
<script>
  $(document).ready(function () {
    // Initialize DataTables for Expenses
    if ($('#expensesTable').length) {
      const dtExpenses = $('#expensesTable').DataTable({
        order: [[5, 'desc']], // Sort by date descending
        pageLength: 10,
        language: {
          search: '',
          searchPlaceholder: 'Search expenses...',
          lengthMenu: 'Show _MENU_ entries'
        },
        columnDefs: [
          {
            targets: -1, // Actions column
            orderable: false,
            searchable: false
          }
        ]
      });
    }
  });
</script>

<!--for Budget Control-->
<script>
  $(document).ready(function () {
    // Budget utilization animation
    const progressBar = document.querySelector('.progress-bar[aria-valuenow="87.8"]');
    if (progressBar) {
      // Animate progress bar on page load
      setTimeout(() => {
        progressBar.style.transition = 'width 1s ease-in-out';
      }, 100);
    }

    // Monthly Budget Trend Chart
    if (document.getElementById('monthlyBudgetTrendChart')) {
      const monthlyTrendOptions = {
        series: [
          {
            name: 'Budget',
            data: [4000000, 4000000, 4000000, 4000000, 4000000, 4000000]
          },
          {
            name: 'Spent',
            data: [3050000, 3150000, 3300000, 3450000, 3500000, 3000000]
          },
          {
            name: 'Committed',
            data: [250000, 280000, 300000, 270000, 290000, 250000]
          }
        ],
        chart: {
          type: 'line',
          height: 350,
          toolbar: {
            show: false
          }
        },
        colors: ['#6c757d', '#696cff', '#ffab00'],
        stroke: {
          width: 3,
          curve: 'smooth'
        },
        markers: {
          size: 5
        },
        xaxis: {
          categories: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yaxis: {
          labels: {
            formatter: function (val) {
              return (val / 1000000).toFixed(1) + 'M';
            }
          },
          min: 0,
          max: 4000000
        },
        legend: {
          position: 'top',
          horizontalAlign: 'right'
        },
        tooltip: {
          y: {
            formatter: function (val) {
              return 'NPR ' + (val / 1000000).toFixed(2) + 'M';
            }
          }
        },
        grid: {
          borderColor: '#e7e7e7',
          strokeDashArray: 3
        }
      };

      const monthlyTrendChart = new ApexCharts(document.querySelector('#monthlyBudgetTrendChart'), monthlyTrendOptions);
      monthlyTrendChart.render();
    }

    // Department Budget Breakdown Chart
    if (document.getElementById('departmentBudgetChart')) {
      const departmentBudgetOptions = {
        series: [
          {
            name: 'Allocated',
            data: [5.0, 3.5, 2.5, 8.0, 4.0]
          },
          {
            name: 'Spent',
            data: [3.8, 3.0, 1.8, 6.5, 2.8]
          },
          {
            name: 'Available',
            data: [0.8, 0.2, 0.6, 0.8, 1.0]
          }
        ],
        chart: {
          type: 'bar',
          height: 350,
          toolbar: {
            show: false
          }
        },
        colors: ['#d3d3d3', '#696cff', '#71dd37'],
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
          categories: ['IT', 'Marketing', 'HR', 'Operations', 'Finance']
        },
        yaxis: {
          labels: {
            formatter: function (val) {
              return val.toFixed(1) + 'M';
            }
          },
          min: 0,
          max: 8
        },
        legend: {
          position: 'top',
          horizontalAlign: 'right'
        },
        tooltip: {
          y: {
            formatter: function (val) {
              return 'NPR ' + val.toFixed(1) + 'M';
            }
          }
        },
        grid: {
          borderColor: '#e7e7e7',
          strokeDashArray: 3
        }
      };

      const departmentBudgetChart = new ApexCharts(document.querySelector('#departmentBudgetChart'), departmentBudgetOptions);
      departmentBudgetChart.render();
    }

    // Real-time budget updates (if needed)
    // This can be extended to fetch live data via AJAX
    function updateBudgetMetrics() {
      // Example: Fetch updated budget data
      // $.ajax({
      //   url: '/api/budget/metrics',
      //   method: 'GET',
      //   success: function(data) {
      //     // Update KPI cards and progress bar
      //   }
      // });
    }

    // Update every 30 seconds (optional)
    // setInterval(updateBudgetMetrics, 30000);

    // Initialize DataTables for Budget Details
    if ($('#budgetDetailsTable').length) {
      const dtBudgetDetails = $('#budgetDetailsTable').DataTable({
        order: [[1, 'asc']], // Sort by department name
        pageLength: 10,
        language: {
          search: '',
          searchPlaceholder: 'Search budgets...',
          lengthMenu: 'Show _MENU_ entries'
        },
        columnDefs: [
          {
            targets: -1, // Actions column
            orderable: false,
            searchable: false
          },
          {
            targets: [2, 3, 4, 5], // Monetary columns
            type: 'num'
          }
        ]
      });
    }
  });
</script>

<!--for Audit Trail-->
<script>
  $(document).ready(function () {
    // Initialize DataTables for Audit Trail
    if ($('#auditTrailTable').length) {
      const dtAuditTrail = $('#auditTrailTable').DataTable({
        order: [[0, 'desc']], // Sort by timestamp descending (newest first)
        pageLength: 10,
        language: {
          search: '',
          searchPlaceholder: 'Search audit logs...',
          lengthMenu: 'Show _MENU_ entries'
        },
        columnDefs: [
          {
            targets: -1, // Actions column
            orderable: false,
            searchable: false
          },
          {
            targets: 0, // Timestamp column
            type: 'date'
          }
        ]
      });

      // Custom search functionality
      $('#auditSearch').on('keyup', function () {
        dtAuditTrail.search(this.value).draw();
      });
    }
  });
</script>

<!--for Settings-->
<script>
  $(document).ready(function () {
    // Wait for SweetAlert2 to be loaded
    if (typeof Swal === 'undefined') {
      console.error('SweetAlert2 is not loaded');
      return;
    }

    // Save Settings button click handler
    $('#saveSettingsBtn').on('click', function (e) {
      e.preventDefault();

      // Collect all settings values
      const settings = {
        systemName: $('#systemName').val(),
        organizationName: $('#organizationName').val(),
        fiscalYear: $('#fiscalYear').val(),
        autoEscalation: $('#autoEscalation').is(':checked'),
        budgetPreCommitment: $('#budgetPreCommitment').is(':checked'),
        slaWarningThreshold: $('#slaWarningThreshold').val(),
        emailNotifications: $('#emailNotifications').is(':checked'),
        smsNotifications: $('#smsNotifications').is(':checked'),
        coreBankingApi: $('#coreBankingApi').val(),
        accountingSystemApi: $('#accountingSystemApi').val(),
        ldapServer: $('#ldapServer').val(),
        auditLogRetention: $('#auditLogRetention').val(),
        documentStorage: $('#documentStorage').val()
      };

      // Show confirmation popup using SweetAlert2
      Swal.fire({
        title: 'Save Settings?',
        text: 'Are you sure you want to save these settings?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, Save Settings',
        cancelButtonText: 'Cancel',
        customClass: {
          confirmButton: 'btn btn-primary',
          cancelButton: 'btn btn-label-secondary'
        },
        buttonsStyling: false
      }).then((result) => {
        if (result.isConfirmed) {
          // Here you can add AJAX call to save settings to server
          // Example:
          // $.ajax({
          //   url: '/api/settings/save',
          //   method: 'POST',
          //   data: settings,
          //   success: function(response) {
          //     Swal.fire({
          //       title: 'Settings Saved!',
          //       text: 'Your settings have been saved successfully.',
          //       icon: 'success',
          //       confirmButtonText: 'OK',
          //       customClass: {
          //         confirmButton: 'btn btn-primary'
          //       },
          //       buttonsStyling: false
          //     });
          //   },
          //   error: function(error) {
          //     Swal.fire({
          //       title: 'Error!',
          //       text: 'Failed to save settings. Please try again.',
          //       icon: 'error',
          //       confirmButtonText: 'OK',
          //       customClass: {
          //         confirmButton: 'btn btn-primary'
          //       },
          //       buttonsStyling: false
          //     });
          //   }
          // });

          // Show success popup (for demo purposes)
          Swal.fire({
            title: 'Settings Saved!',
            text: 'Your settings have been saved successfully.',
            icon: 'success',
            confirmButtonText: 'OK',
            customClass: {
              confirmButton: 'btn btn-primary'
            },
            buttonsStyling: false,
            timer: 2000,
            timerProgressBar: true
          });
        }
      });
    });
  });
</script>
